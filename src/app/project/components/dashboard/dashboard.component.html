<!-- dashboard.component.html (ACTUALIZADO) -->

<!-- Contenido principal -->
<main class="main-content">
  <!-- Barra superior -->
  <div class="top-bar">
    <button class="btn-secondary-plus" [routerLink]="['../create']">
      <span>+</span> Nuevo
    </button>

    <div class="search-filters">
      <div class="search-bar">
        <span class="search-icon"><i class="fa-solid fa-magnifying-glass"></i></span>
        <input 
          type="text" 
          placeholder="Buscar proyectos..." 
          [(ngModel)]="searchQuery"
          (input)="onSearch()"
        >
      </div>

      <div class="filter-group">
        <div class="dropdown">
          <button class="dropdown-btn" (click)="toggleSkillsDropdown()">
            Habilidades
            <span class="arrow">▼</span>
          </button>
          <div class="dropdown-menu" *ngIf="showSkillsDropdown">
            <label 
              class="dropdown-item" 
              *ngFor="let skill of availableSkills"
              (click)="$event.stopPropagation()"
            >
              <input 
                type="checkbox" 
                [(ngModel)]="skill.selected"
                (change)="onSkillsChange()"
              >
              <span>{{skill.name}}</span>
            </label>
          </div>
        </div>

        <div class="dropdown">
          <button class="dropdown-btn" (click)="toggleCategoryDropdown()">
            Categoría
            <span class="arrow">▼</span>
          </button>
          <div class="dropdown-menu" *ngIf="showCategoryDropdown">
            <label 
              class="dropdown-item" 
              *ngFor="let category of categories"
              (click)="$event.stopPropagation()"
            >
              <input 
                type="radio" 
                name="category" 
                [(ngModel)]="selectedCategory" 
                [value]="category"
                (change)="onCategoryChange()"
              >
              <span>{{category}}</span>
            </label>
          </div>
        </div>
      </div>

      <div class="toggle-buttons">
        <button 
          class="toggle-btn" 
          [class.active]="viewMode === 'public'" 
          (click)="changeViewMode('public')"
          title="Proyectos públicos"
        >
          <i class="fa-solid fa-users"></i>
        </button>

        <button 
          class="toggle-btn" 
          [class.active]="viewMode === 'registered'" 
          (click)="changeViewMode('registered')"
          title="Mis colaboraciones"
        >
          <i class="fa-solid fa-hand-fist"></i>
        </button>

        <button 
          class="toggle-btn" 
          [class.active]="viewMode === 'profile'" 
          (click)="changeViewMode('profile')"
          title="Mis proyectos"
        >
          <i class="fa-solid fa-person"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Grid de proyectos -->
  <div class="projects-container">
    <div class="projects-grid">
      <div 
        class="project-card" 
        *ngFor="let project of filteredProjects"
        (click)="openProjectDetail(project)"
      >
        <div class="project-category">{{project.category}}</div>
        <h3 class="project-title">{{project.title}}</h3>
        <p class="project-description">{{project.description}}</p>
        <div class="project-skills">
          <span class="skill-tag" *ngFor="let skill of project.skills">{{skill}}</span>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Modal de detalle del proyecto -->
<div class="modal-overlay" *ngIf="selectedProject" (click)="closeProjectDetail()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{selectedProject.title}}</h2>
      
      <!-- Mostrar si estoy viendo proyectos públicos -->
      <button 
        class="btn-primary" 
        *ngIf="viewMode === 'public'" 
        (click)="requestJoin()">
        <i class="fa-solid fa-paper-plane icon"></i>Solicitar unirse
      </button>

      <!-- Mostrar si estoy viendo MIS proyectos -->
      <button 
        class="btn-secondary" 
        *ngIf="viewMode === 'profile'" 
        (click)="manageProject(selectedProject.id)">
        <i class="fa-solid fa-pen icon"></i>Gestionar
      </button>

      <!-- Mostrar si estoy viendo proyectos donde colaboro -->
      <button 
        class="btn-secondary" 
        *ngIf="viewMode === 'registered'" 
        (click)="workProject(selectedProject.id)">
        <i class="fa-solid fa-person-walking-arrow-right icon"></i>Ingresar
      </button>
    </div>

    <div class="modal-body">
      <div class="project-info">
        <h3>Descripción</h3>
        <p>{{selectedProject.description}}</p>
      </div>

      <div class="tasks-section" *ngIf="selectedProject.tasks">
        <h3>Tareas</h3>
        
        <div class="tasks-board">
          <div class="task-column">
            <h4 class="column-title todo">Por hacer</h4>
            <div class="task-item" *ngFor="let task of selectedProject.tasks.todo">
              {{task}}
            </div>
          </div>

          <div class="task-column">
            <h4 class="column-title in-progress">En progreso</h4>
            <div class="task-item" *ngFor="let task of selectedProject.tasks.inProgress">
              {{task}}
            </div>
          </div>

          <div class="task-column">
            <h4 class="column-title review">En revisión</h4>
            <div class="task-item" *ngFor="let task of selectedProject.tasks.review">
              {{task}}
            </div>
          </div>

          <div class="task-column">
            <h4 class="column-title done">Hecho</h4>
            <div class="task-item" *ngFor="let task of selectedProject.tasks.done">
              {{task}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>